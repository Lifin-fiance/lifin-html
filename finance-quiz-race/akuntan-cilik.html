<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Akuntan Cilik LIFIN</title>
    <link rel="icon" type="image/png" href="/LIFIN/assets/images/fav.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body {
        font-family: 'Baloo 2', sans-serif;
    }
    .correct-answer {
        background-color: #4ade80 !important;
        border-color: #22c55e !important;
        color: white;
    }
    .wrong-answer {
        background-color: #f87171 !important;
        border-color: #ef4444 !important;
        color: white;
    }
    .hidden {
        display: none;
    }
    .calculator-btn {
        background-color: white;
        font-size: 1.5rem; /* 2xl */
        font-weight: 700; /* bold */
        border-radius: 0.5rem; /* rounded-lg */
        transition: background-color 200ms;
        border-width: 1px;
        border-color: #d1d5db; /* border-gray-300 */
    }
    .calculator-btn:hover {
        background-color: #f3f4f6; /* hover:bg-gray-100 */
    }
    .calculator-btn.operator {
        background-color: #f59e0b; /* bg-amber-500 */
        color: white;
        border-color: #d97706; /* border-amber-600 */
    }
    .calculator-btn.operator:hover {
        background-color: #d97706; /* hover:bg-amber-600 */
    }
  </style>
</head>
<body class="bg-[#04B3E3] flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-4xl">
    <!-- Layar Permainan Akuntan Cilik -->
    <div id="accountant-screen" class="bg-white rounded-3xl p-6 sm:p-8">
        <h1 class="text-3xl font-extrabold text-[#006F8D] text-center mb-4">Akuntan Cilik</h1>
        <div class="flex flex-col md:flex-row gap-6">
            
            <!-- Bagian Soal -->
            <div class="flex-1">
                <p id="accountant-counter" class="text-gray-600 mb-2 text-center md:text-left">Memuat soal...</p>
                <div class="bg-gray-100 rounded-2xl p-6 mb-4 min-h-[10rem] flex items-center justify-center">
                    <p id="accountant-problem" class="text-xl font-semibold text-gray-800 text-center"></p>
                </div>
                <input type="number" id="accountant-answer" class="w-full p-3 text-xl border-2 border-gray-300 rounded-lg focus:outline-none focus:border-[#04B3E3] transition-colors" placeholder="Masukkan jawabanmu...">
                <button id="check-accountant-answer" class="w-full mt-4 bg-purple-600 text-white font-bold text-xl py-3 rounded-lg hover:bg-purple-700 transition-colors">Cek Jawaban</button>
                <div id="accountant-feedback" class="mt-2 text-center font-bold"></div>
            </div>

            <!-- Kalkulator -->
            <div class="w-full md:w-64 bg-gray-100 p-3 rounded-2xl border border-gray-200">
                <div id="calculator-display" class="bg-white text-right text-3xl font-mono p-3 rounded-lg mb-3 h-16 overflow-x-auto text-gray-800 border border-gray-300">0</div>
                <div class="grid grid-cols-4 gap-2">
                    <button class="calculator-btn operator" data-key="C">C</button>
                    <button class="calculator-btn operator" data-key="%">%</button>
                    <button class="calculator-btn operator" data-key="/">/</button>
                    <button class="calculator-btn operator" data-key="*">*</button>
                    <button class="calculator-btn" data-key="7">7</button>
                    <button class="calculator-btn" data-key="8">8</button>
                    <button class="calculator-btn" data-key="9">9</button>
                    <button class="calculator-btn operator" data-key="-">-</button>
                    <button class="calculator-btn" data-key="4">4</button>
                    <button class="calculator-btn" data-key="5">5</button>
                    <button class="calculator-btn" data-key="6">6</button>
                    <button class="calculator-btn operator" data-key="+">+</button>
                    <button class="calculator-btn" data-key="1">1</button>
                    <button class="calculator-btn" data-key="2">2</button>
                    <button class="calculator-btn" data-key="3">3</button>
                    <button class="calculator-btn operator row-span-2" data-key="=">=</button>
                    <button class="calculator-btn col-span-2" data-key="0">0</button>
                    <button class="calculator-btn" data-key=".">.</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Layar Rangkuman -->
    <div id="summary-screen" class="hidden bg-white rounded-3xl p-8 text-center">
        <h2 class="text-4xl font-extrabold text-[#006F8D] mb-4">Game Selesai!</h2>
        <p class="text-xl text-gray-700 mb-2">Skor Akhir Kamu:</p>
        <p id="final-score" class="text-6xl font-bold text-purple-600 mb-6">0 / 0</p>
        <p id="score-message" class="text-lg text-gray-600 mb-8"></p>
        <button id="restart-game" class="bg-amber-500 text-white font-bold text-xl py-3 px-8 rounded-lg hover:bg-amber-600 transition-colors">Main Lagi</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Referensi Elemen DOM ---
        const accountantScreen = document.getElementById('accountant-screen');
        const summaryScreen = document.getElementById('summary-screen');
        
        // --- State Game Akuntan---
        let allAccountantQuestions = [];
        let gameQuestions = [];
        const accountantProblem = document.getElementById('accountant-problem');
        const accountantCounter = document.getElementById('accountant-counter');
        const accountantAnswerInput = document.getElementById('accountant-answer');
        const checkAccountantAnswerBtn = document.getElementById('check-accountant-answer');
        const accountantFeedback = document.getElementById('accountant-feedback');
        let currentAccountantIndex = 0, accountantScore = 0;

        // --- Elemen Rangkuman ---
        const finalScoreEl = document.getElementById('final-score');
        const scoreMessageEl = document.getElementById('score-message');
        const restartGameBtn = document.getElementById('restart-game');

        // --- Kalkulator State ---
        const calculatorDisplay = document.getElementById('calculator-display');
        let calculatorState = { displayValue: '0', firstOperand: null, waitingForSecondOperand: false, operator: null };
        
        // --- Fungsi Utama ---
        async function loadData() {
            try {
                const response = await fetch('/LIFIN/data/soal-akuntancilik-financequizrace.json');
                if (!response.ok) throw new Error(`Gagal mengambil data: ${response.statusText}`);
                
                const data = await response.json();
                if (data && Array.isArray(data)) {
                    allAccountantQuestions = data;
                } else {
                    throw new Error("Format data JSON tidak sesuai.");
                }

            } catch (error) {
                console.error("Gagal memuat data soal:", error);
                accountantProblem.textContent = "Maaf, gagal memuat soal. Coba muat ulang halaman.";
                checkAccountantAnswerBtn.disabled = true;
            }
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            if (allAccountantQuestions.length === 0) {
                accountantProblem.textContent = "Tidak ada soal yang bisa ditampilkan.";
                return;
            }
            
            currentAccountantIndex = 0;
            accountantScore = 0;
            shuffleArray(allAccountantQuestions);
            gameQuestions = allAccountantQuestions.slice(0, 10);

            summaryScreen.classList.add('hidden');
            accountantScreen.classList.remove('hidden');
            displayAccountantProblem();
        }

        function displayAccountantProblem() {
            if (currentAccountantIndex >= gameQuestions.length) {
                endGame();
                return;
            }

            const currentProblem = gameQuestions[currentAccountantIndex];
            accountantCounter.textContent = `Soal ${currentAccountantIndex + 1} dari ${gameQuestions.length}`;
            accountantProblem.textContent = currentProblem.Pertanyaan;
            accountantAnswerInput.value = '';
            accountantFeedback.textContent = '';
            checkAccountantAnswerBtn.disabled = false;
            accountantAnswerInput.className = 'w-full p-3 text-xl border-2 border-gray-300 rounded-lg focus:outline-none focus:border-[#04B3E3] transition-colors';
            accountantAnswerInput.focus();
        }

        function checkAccountantAnswer() {
            if (checkAccountantAnswerBtn.disabled) return;

            const userAnswer = accountantAnswerInput.value.trim();

            // PERUBAHAN: Cek jika input jawaban kosong
            if (userAnswer === '') {
                accountantFeedback.textContent = "Harap isi jawabanmu terlebih dahulu!";
                // Menggunakan warna amber untuk peringatan
                accountantFeedback.className = "mt-2 text-center font-bold text-amber-500";
                
                // Memberi efek visual pada input field untuk menarik perhatian
                accountantAnswerInput.classList.add('border-amber-500');
                setTimeout(() => {
                    // Menghapus efek setelah beberapa saat
                    accountantAnswerInput.classList.remove('border-amber-500');
                }, 1500);

                return; // Menghentikan fungsi jika tidak ada jawaban
            }

            const correctAnswer = String(gameQuestions[currentAccountantIndex].Jawaban).toLowerCase();
            
            if (userAnswer.toLowerCase() === correctAnswer) {
                accountantScore++;
                accountantFeedback.textContent = "Benar! 🎉";
                accountantFeedback.className = "mt-2 text-center font-bold text-green-500";
                accountantAnswerInput.classList.add('correct-answer');
            } else {
                accountantFeedback.textContent = `Salah! Jawaban yang benar: ${gameQuestions[currentAccountantIndex].Jawaban}`;
                accountantFeedback.className = "mt-2 text-center font-bold text-red-500";
                accountantAnswerInput.classList.add('wrong-answer');
            }
            
            checkAccountantAnswerBtn.disabled = true;
            
            setTimeout(() => {
                currentAccountantIndex++;
                displayAccountantProblem();
            }, 2000);
        }
        
        function endGame() {
            accountantScreen.classList.add('hidden');
            summaryScreen.classList.remove('hidden');
            finalScoreEl.textContent = `${accountantScore} / ${gameQuestions.length}`;
            
            const percentage = (gameQuestions.length > 0) ? (accountantScore / gameQuestions.length) * 100 : 0;
            if (percentage === 100) {
                scoreMessageEl.textContent = "Sempurna! Kamu ahli keuangan sejati!";
            } else if (percentage >= 75) {
                scoreMessageEl.textContent = "Luar biasa! Pemahaman keuanganmu sangat baik!";
            } else if (percentage >= 50) {
                scoreMessageEl.textContent = "Bagus! Terus asah kemampuanmu!";
            } else {
                scoreMessageEl.textContent = "Jangan menyerah! Coba lagi untuk jadi lebih baik.";
            }
        }

        // --- Logika Kalkulator ---
        function setupCalculator() {
            const calculator = document.querySelector('#accountant-screen .grid');
            calculator.addEventListener('click', (e) => {
                if (!e.target.matches('.calculator-btn')) return;
                const key = e.target.dataset.key;
                
                if (key === '=') calculate();
                else if (key === 'C') resetCalculator();
                else if (key === '%') handlePercent();
                else if (['/', '*', '-', '+'].includes(key)) handleOperator(key);
                else if (key === '.') inputDecimal(key);
                else inputDigit(key);
                
                updateDisplay();
            });
        }

        function inputDigit(digit) {
            const { displayValue, waitingForSecondOperand } = calculatorState;
            if (waitingForSecondOperand === true) {
                calculatorState.displayValue = digit;
                calculatorState.waitingForSecondOperand = false;
            } else {
                calculatorState.displayValue = displayValue === '0' ? digit : displayValue + digit;
            }
        }

        function inputDecimal(dot) {
            if (calculatorState.waitingForSecondOperand) return;
            if (!calculatorState.displayValue.includes(dot)) {
                calculatorState.displayValue += dot;
            }
        }

        function handleOperator(nextOperator) {
            const { firstOperand, displayValue, operator } = calculatorState;
            const inputValue = parseFloat(displayValue);
            if (operator && calculatorState.waitingForSecondOperand) {
                calculatorState.operator = nextOperator;
                return;
            }
            if (firstOperand == null && !isNaN(inputValue)) {
                calculatorState.firstOperand = inputValue;
            } else if (operator) {
                const result = performCalculation[operator](firstOperand, inputValue);
                calculatorState.displayValue = `${parseFloat(result.toFixed(7))}`;
                calculatorState.firstOperand = result;
            }
            calculatorState.waitingForSecondOperand = true;
            calculatorState.operator = nextOperator;
        }

        function handlePercent() {
            const { displayValue } = calculatorState;
            const currentValue = parseFloat(displayValue);
            if (currentValue === 0) return;
            calculatorState.displayValue = String(currentValue / 100);
        }

        const performCalculation = {
            '/': (firstOperand, secondOperand) => secondOperand !== 0 ? firstOperand / secondOperand : 'Error',
            '*': (firstOperand, secondOperand) => firstOperand * secondOperand,
            '+': (firstOperand, secondOperand) => firstOperand + secondOperand,
            '-': (firstOperand, secondOperand) => firstOperand - secondOperand,
        };

        function calculate() {
            const { firstOperand, displayValue, operator } = calculatorState;
            const inputValue = parseFloat(displayValue);
            if (operator && !calculatorState.waitingForSecondOperand) {
                const result = performCalculation[operator](firstOperand, inputValue);
                calculatorState.displayValue = (result === 'Error') ? 'Error' : `${parseFloat(result.toFixed(7))}`;
                calculatorState.firstOperand = null;
                calculatorState.operator = null;
            }
            calculatorState.waitingForSecondOperand = false;
        }

        function resetCalculator() {
            calculatorState = { displayValue: '0', firstOperand: null, waitingForSecondOperand: false, operator: null };
        }

        function updateDisplay() {
            calculatorDisplay.textContent = calculatorState.displayValue;
        }

        // --- Event Listeners ---
        checkAccountantAnswerBtn.addEventListener('click', checkAccountantAnswer);
        
        accountantAnswerInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkAccountantAnswer();
            }
            if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                e.preventDefault();
            }
        });
        
        accountantAnswerInput.addEventListener('wheel', (e) => {
            e.preventDefault();
        });

        restartGameBtn.addEventListener('click', startGame);

        // --- Inisialisasi ---
        async function initialize() {
            accountantScreen.classList.add('hidden');
            setupCalculator();
            await loadData();
            startGame();
        }
        
        initialize();
    });
  </script>

</body>
</html>
