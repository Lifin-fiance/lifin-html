<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Time Explore LIFIN</title>
    <link rel="icon" type="image/png" href="/LIFIN/assets/images/fav.png">
  <meta name="description" content="Belajar kelola uang jadi seru di LIFIN! Platform literasi finansial untuk pelajar SMP & SMA. Kuasai cara nabung & investasi lewat game edukasi dan chatbot pintar. Mulai gratis!">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body {
        font-family: 'Baloo 2', sans-serif;
    }
    .rounded-top-100 {
      border-top-left-radius: 100px;
      border-top-right-radius: 100px;
    }
    .rounded-bottom-30 {
      border-bottom-left-radius: 30px;
      border-bottom-right-radius: 30px;
    }
    .rounded-full-custom {
      border-radius: 100px;
    }
    .correct-answer, .correct-answer-bg {
        background-color: #4ade80 !important;
        border-color: #22c55e !important;
    }
    .wrong-answer, .wrong-answer-bg {
        background-color: #f87171 !important;
        border-color: #ef4444 !important;
    }
    .hidden {
        display: none;
    }
    .progress-bar-fill {
        transition: width 0.5s ease-in-out;
    }
    /* Drag and Drop Styles */
    .drop-zone {
        transition: background-color 0.3s, border-color 0.3s;
    }
    .drop-zone.drag-over {
        background-color: #e0f7fa; /* Light cyan */
    }
    .drop-zone.correct-drop {
        border-color: #22c55e;
        background-color: #dcfce7;
    }
    .drop-zone.wrong-drop {
        border-color: #ef4444;
        background-color: #fee2e2;
    }
    .draggable-item {
        cursor: grab;
    }
    .draggable-item:active {
        cursor: grabbing;
    }
    /* Calculator Styles */
    .calculator-btn {
        @apply bg-gray-200 hover:bg-gray-300 text-2xl font-bold rounded-lg transition-colors duration-200;
    }
    .calculator-btn.operator {
        @apply bg-amber-500 hover:bg-amber-600 text-white;
    }
    /* Time Traveler Styles */
    .era-card {
        @apply bg-gray-200 p-6 rounded-2xl text-center transition-transform duration-300;
    }
    .era-card.unlocked {
        @apply bg-gradient-to-br from-amber-400 to-yellow-500 text-white cursor-pointer hover:scale-105;
    }
    .era-card.locked {
        @apply bg-gray-400 text-gray-600 cursor-not-allowed;
    }
  </style>
</head>
<body class="bg-[#04B3E3] flex items-center justify-center min-h-screen p-4">

  <!-- Wrapper -->
  <div class="w-full max-w-4xl">

    <!-- Layar Pemilihan Mode -->
    <div id="mode-selection-screen" class="bg-white rounded-3xl p-8 text-center">
        <h1 class="text-4xl font-extrabold text-[#006F8D] mb-8">Pilih Mode Permainan</h1>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 justify-center">
            <button id="race-end-btn" class="bg-[#FFD635] text-[#004b75] font-bold text-2xl py-6 px-4 rounded-2xl shadow-lg hover:scale-105 transition-transform"><p>Race End</p><p class="text-sm font-normal mt-1">Jawab 20 soal secepat mungkin!</p></button>
            <button id="dead-level-btn" class="bg-[#f87171] text-white font-bold text-2xl py-6 px-4 rounded-2xl shadow-lg hover:scale-105 transition-transform"><p>Dead Level</p><p class="text-sm font-normal mt-1">Jawab soal dalam 4 detik!</p></button>
            <button id="drag-drop-btn" class="bg-[#36c2e9] text-white font-bold text-2xl py-6 px-4 rounded-2xl shadow-lg hover:scale-105 transition-transform"><p>Sortir Barang</p><p class="text-sm font-normal mt-1">Kelompokkan kebutuhan & keinginan!</p></button>
            <button id="true-false-btn" class="bg-[#2dd4bf] text-white font-bold text-2xl py-6 px-4 rounded-2xl shadow-lg hover:scale-105 transition-transform"><p>Benar atau Salah</p><p class="text-sm font-normal mt-1">Tentukan pernyataan yang tepat!</p></button>
            <button id="accountant-btn" class="bg-[#a78bfa] text-white font-bold text-2xl py-6 px-4 rounded-2xl shadow-lg hover:scale-105 transition-transform"><p>Akuntan Explorer</p><p class="text-sm font-normal mt-1">Hitung soal matematika keuangan!</p></button>
            <button id="time-traveler-btn" class="bg-slate-700 text-white font-bold text-2xl py-6 px-4 rounded-2xl shadow-lg hover:scale-105 transition-transform"><p>Penjelajah Waktu</p><p class="text-sm font-normal mt-1">Jelajahi sejarah uang!</p></button>
        </div>
    </div>

    <!-- Kontainer Game Kuis -->
    <div id="game-container" class="hidden"><!-- ... Konten kuis ... --></div>
    <!-- ... Kontainer mode lain ... -->

    <!-- Kontainer Game Penjelajah Waktu -->
    <div id="time-traveler-screen" class="hidden">
        <!-- Layar Pemilihan Era -->
        <div id="era-selection-screen" class="bg-white rounded-3xl p-8 text-center">
            <h1 class="text-4xl font-extrabold text-[#006F8D] mb-8">Pilih Era Sejarah</h1>
            <div id="era-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Kartu Era akan digenerate oleh JS -->
            </div>
            <button id="back-to-main-menu" class="mt-8 bg-gray-500 text-white font-bold text-xl py-3 px-10 rounded-xl shadow-lg hover:bg-gray-600 transition-transform">Kembali</button>
        </div>

        <!-- Layar Kuis Era -->
        <div id="era-quiz-screen" class="hidden bg-white rounded-3xl p-6 sm:p-8">
             <h2 id="era-quiz-title" class="text-3xl font-extrabold text-[#006F8D] text-center mb-4"></h2>
             <p id="era-question-counter" class="text-center text-gray-600 mb-6"></p>
             <div id="era-question" class="text-center text-2xl font-semibold text-gray-800 mb-6 min-h-[8rem] flex items-center justify-center"></div>
             <div id="era-options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-3xl mx-auto">
                 <!-- Opsi jawaban akan digenerate oleh JS -->
             </div>
        </div>
    </div>
    
    <!-- Pop-up Penjelasan (untuk Penjelajah Waktu) -->
    <div id="explanation-popup" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full text-center">
            <h2 id="explanation-title" class="text-2xl font-bold text-[#006F8D] mb-4">Fakta Sejarah!</h2>
            <p id="explanation-text" class="text-lg text-gray-700 mb-6"></p>
            <button id="next-era-question-btn" class="bg-[#FFD635] text-[#004b75] font-bold text-xl py-3 px-10 rounded-xl shadow-lg">Lanjut</button>
        </div>
    </div>

    <!-- Layar Rangkuman -->
    <div id="summary-screen" class="hidden"><!-- ... Konten Rangkuman ... --></div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Referensi Elemen DOM ---
        const modeSelectionScreen = document.getElementById('mode-selection-screen');
        const timeTravelerBtn = document.getElementById('time-traveler-btn');
        const timeTravelerScreen = document.getElementById('time-traveler-screen');
        const eraSelectionScreen = document.getElementById('era-selection-screen');
        const eraQuizScreen = document.getElementById('era-quiz-screen');
        const eraGrid = document.getElementById('era-grid');
        const backToMainMenuBtn = document.getElementById('back-to-main-menu');
        const explanationPopup = document.getElementById('explanation-popup');
        
        // --- State Game ---
        let timeTravelerData = {};
        let gameMode = '';
        let unlockedEra = 1;
        let currentEra = null;
        let currentEraQuestionIndex = 0;

        // --- Fungsi Utama ---
        async function loadData() {
            try {
                // Fetch data dari file JSON eksternal
                const response = await fetch('/LIFIN/data/soal-penjelajahwaktu-financequizrace.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const allQuestions = await response.json();
                
                // Proses dan kelompokkan data soal berdasarkan era
                const groupedEras = {};
                const eraOrder = [
                    "Era Barter",
                    "Era Uang Komoditas",
                    "Era Uang Logam (Nusantara)",
                    "Era Uang Kolonial",
                    "Era Uang Perjuangan",
                    "Era Rupiah Modern",
                    "Era Dompet Digital & QRIS",
                    "Era Aset Digital & Masa Depan Uang"
                ];

                // Inisialisasi struktur data
                eraOrder.forEach((eraName, index) => {
                    const eraId = index + 1;
                    groupedEras[eraId] = {
                        id: eraId,
                        name: eraName,
                        questions: []
                    };
                });

                // Masukkan soal ke dalam era yang sesuai
                allQuestions.forEach(q => {
                    const eraIndex = eraOrder.indexOf(q["Judul Era"]);
                    if (eraIndex !== -1) {
                        const eraId = eraIndex + 1;
                        
                        // Konversi format pilihan ganda dan kunci jawaban
                        const options = q["Pilihan Ganda"].split('<br>').map(opt => opt.replace(/^[a-d]\.\s*/, ''));
                        const correctLetter = q["Kunci Jawaban"].trim().toLowerCase();
                        const correctIndex = correctLetter.charCodeAt(0) - 'a'.charCodeAt(0);

                        groupedEras[eraId].questions.push({
                            q: q.Pertanyaan,
                            o: options,
                            a: correctIndex,
                            exp: q.Penjelasan
                        });
                    }
                });
                
                timeTravelerData = groupedEras;
                console.log("Data Penjelajah Waktu berhasil dimuat:", timeTravelerData);

            } catch (error) {
                console.error("Gagal memuat data soal:", error);
                // Tampilkan pesan error kepada pengguna jika perlu
                alert('Gagal memuat data soal. Silakan coba muat ulang halaman.');
            }
        }
        
        function startGame(mode) {
            gameMode = mode;
            modeSelectionScreen.classList.add('hidden');
            
            if (mode === 'time-traveler') {
                timeTravelerScreen.classList.remove('hidden');
                eraQuizScreen.classList.add('hidden');
                eraSelectionScreen.classList.remove('hidden');
                renderEraSelection();
            }
        }

        // --- Logika Penjelajah Waktu ---
        function loadUnlockedEra() {
            const savedEra = localStorage.getItem('unlockedEra');
            unlockedEra = savedEra ? parseInt(savedEra, 10) : 1;
        }

        function saveUnlockedEra(eraNumber) {
            // Hanya simpan jika era baru lebih tinggi dari yang sudah terbuka
            if (eraNumber > unlockedEra) {
                unlockedEra = eraNumber;
                localStorage.setItem('unlockedEra', unlockedEra);
            }
        }

        function renderEraSelection() {
            eraGrid.innerHTML = '';
            for (const eraId in timeTravelerData) {
                const era = timeTravelerData[eraId];
                const card = document.createElement('div');
                card.className = 'era-card';
                card.dataset.eraId = eraId;
                
                const title = document.createElement('h3');
                title.className = 'text-xl font-bold';
                title.textContent = era.name;
                card.appendChild(title);

                if (parseInt(eraId) <= unlockedEra) {
                    card.classList.add('unlocked');
                    card.addEventListener('click', () => startEraQuiz(eraId));
                } else {
                    card.classList.add('locked');
                    const lockIcon = document.createElement('span');
                    lockIcon.textContent = '🔒';
                    lockIcon.className = 'text-3xl mt-2 block';
                    card.appendChild(lockIcon);
                }
                eraGrid.appendChild(card);
            }
        }

        function startEraQuiz(eraId) {
            currentEra = timeTravelerData[eraId];
            if (!currentEra || currentEra.questions.length === 0) {
                // Gunakan kotak pesan custom, bukan alert
                showCustomAlert("Soal untuk era ini belum tersedia!");
                return;
            }
            currentEra.id = eraId;
            currentEraQuestionIndex = 0;
            eraSelectionScreen.classList.add('hidden');
            eraQuizScreen.classList.remove('hidden');
            displayEraQuestion();
        }

        function displayEraQuestion() {
            if (currentEraQuestionIndex >= currentEra.questions.length) {
                // Era Selesai
                const nextEra = parseInt(currentEra.id) + 1;
                saveUnlockedEra(nextEra);
                showCustomAlert(`Selamat! Kamu telah menyelesaikan ${currentEra.name}. Era berikutnya terbuka!`, () => {
                    eraQuizScreen.classList.add('hidden');
                    eraSelectionScreen.classList.remove('hidden');
                    renderEraSelection();
                });
                return;
            }

            const qData = currentEra.questions[currentEraQuestionIndex];
            document.getElementById('era-quiz-title').textContent = currentEra.name;
            document.getElementById('era-question-counter').textContent = `Soal ${currentEraQuestionIndex + 1} dari ${currentEra.questions.length}`;
            document.getElementById('era-question').innerHTML = qData.q; // Gunakan innerHTML untuk render break line jika ada
            
            const optionsContainer = document.getElementById('era-options-container');
            optionsContainer.innerHTML = '';
            qData.o.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button w-full min-h-[60px] bg-[#36c2e9]/65 rounded-2xl flex items-center p-2 gap-3 cursor-pointer hover:bg-[#36c2e9] transition-colors duration-200';
                button.innerHTML = `<div class="w-10 h-10 bg-[#004b75]/65 rounded-full flex-shrink-0 flex items-center justify-center"><span class="text-white font-bold text-xl">${String.fromCharCode(65 + index)}</span></div><span class="option-text text-[#004b75] font-bold text-left pr-2">${option}</span>`;
                button.addEventListener('click', () => checkEraAnswer(index, qData.a, qData.exp));
                optionsContainer.appendChild(button);
            });
        }

        function checkEraAnswer(selectedIndex, correctIndex, explanation) {
            const buttons = document.querySelectorAll('#era-options-container .option-button');
            buttons.forEach(btn => btn.disabled = true);

            if (selectedIndex === correctIndex) {
                buttons[selectedIndex].classList.add('correct-answer');
            } else {
                buttons[selectedIndex].classList.add('wrong-answer');
                buttons[correctIndex].classList.add('correct-answer');
            }
            
            showExplanation(explanation);
        }

        function showExplanation(explanation) {
            document.getElementById('explanation-text').innerHTML = explanation; // Gunakan innerHTML
            explanationPopup.classList.remove('hidden');
        }

        // Fungsi untuk menampilkan alert custom
        function showCustomAlert(message, callback) {
            const alertPopup = document.createElement('div');
            alertPopup.className = 'fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50';
            alertPopup.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full text-center shadow-2xl">
                    <p class="text-lg text-gray-800 mb-6">${message}</p>
                    <button id="custom-alert-ok-btn" class="bg-[#FFD635] text-[#004b75] font-bold text-xl py-3 px-10 rounded-xl shadow-lg">OK</button>
                </div>
            `;
            document.body.appendChild(alertPopup);

            document.getElementById('custom-alert-ok-btn').addEventListener('click', () => {
                alertPopup.remove();
                if (callback) {
                    callback();
                }
            });
        }


        // --- Event Listeners ---
        timeTravelerBtn.addEventListener('click', () => startGame('time-traveler'));
        backToMainMenuBtn.addEventListener('click', () => {
            timeTravelerScreen.classList.add('hidden');
            modeSelectionScreen.classList.remove('hidden');
        });
        document.getElementById('next-era-question-btn').addEventListener('click', () => {
            explanationPopup.classList.add('hidden');
            currentEraQuestionIndex++;
            displayEraQuestion();
        });


        // --- Inisialisasi ---
        loadData();
        loadUnlockedEra(); // Muat progress saat aplikasi dimulai
    });
  </script>

</body>
</html>
