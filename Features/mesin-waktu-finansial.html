<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mesin Waktu Finansial</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Import Baloo 2 dan Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@800&family=Poppins:wght@700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Baloo 2', cursive;
      background-color: #04b3e3;
    }
    input::placeholder {
      color: #D6D6D6;
    }
  </style>
</head>

<body class="m-0 p-0 box-border overflow-x-hidden">

  <!-- HEADER (Navbar) -->
  <!-- Placeholder untuk navbar yang akan diisi oleh component.js -->
  <header class="absolute top-0 left-0 w-full z-[1000] " id="navbar-container"></header>

  <!-- Konten Utama -->
  <main class="pt-[185px] lg:pt-[210px] sm:px-6">
    
    <img src="../assets/images/mascotfin.png" class="absolute w-[300px] top-[90px] left-1/2 -translate-x-1/2 top-[-20px] lg:w-[400px] lg:top-[80px] z-[-1]" alt="Finny"/>

    <div class="relative w-full max-w-[1062px] h-auto bg-white rounded-[25px] mx-auto mb-16 lg:h-[470px] lg:mb-[96px] py-6 lg:py-0">
      <div class="text-center  font-['Baloo_2'] pt-0 lg:pt-[18px] text-[#04B3E3] text-3xl md:text-4xl lg:text-[40px] font-extrabold">MESIN WAKTU FINANSIAL</div>

      <div class="relative pb-[30px] w-11/12 lg:w-[906px] h-auto bg-[#04B3E3] rounded-[25px] mx-auto mt-6 lg:mt-[24px] p-6 lg:px-[77px] lg:pt-[24px] lg:pb-[68px]">
        <div class="flex flex-col lg:flex-row items-center gap-4 lg:gap-[16px] whitespace-nowrap">
          <div class="text-white text-xl lg:text-[24px] font-extrabold">Kalau aku nabung</div>
          <input id="nominal" type="number" placeholder="Rp100.000"
             class="w-full lg:w-[159px] h-[32px] rounded-full px-4 text-lg lg:text-[20px] font-extrabold font-['Baloo_2'] text-[#04B3E3] bg-white shadow-[0_5px_0_rgba(255,255,255,0.75)] outline-none"/>
          <div class="text-white text-xl lg:text-[24px] font-extrabold">tiap hari selama</div>
          <input id="durasi" type="text" placeholder="20 hari"
             class="w-full lg:w-[128px] h-[32px] rounded-full px-4 text-lg lg:text-[20px] font-extrabold font-['Baloo_2'] text-[#04B3E3] bg-white shadow-[0_5px_0_rgba(255,255,255,0.75)] outline-none"/>
        </div>
        <div class="text-center lg:text-left lg:absolute lg:left-30 lg:top-[70px] text-white text-xl lg:text-[24px] font-extrabold mt-4 lg:mt-0">
          bisa beli apa?
        </div>
        <button id="btnHitung" type="button"
            class="w-[155px] mt-3 lg:mt-0 absolute left-1/2 -translate-x-1/2 lg:bottom-[-21px] lg:w-[218px] h-[43px] bg-white rounded-full shadow-[0_5px_0_#04B3E3] flex items-center justify-center text-[#04B3E3] font-extrabold text-2xl lg:text-[28px]">HITUNG</button>
      </div>

      <div class="h-14 lg:h-[45px]"></div>

      <div class="flex flex-col lg:flex-row justify-between gap-8 lg:gap-4 px-4 sm:px-8 lg:px-[77px]">
        <div class="w-full lg:w-[328px] h-auto min-h-[188px] bg-[#FF6B6B] rounded-[25px] p-4">
          <div class="text-white text-[20px] lg:text-2xl font-bold font-['Poppins'] text-center">
            Total Tabungan
          </div>
          <div id="totalTabungan" class="text-white text-center font-['Poppins'] text-3xl font-bold pt-4 break-words"></div>
        </div>
        
        <div class="w-full lg:w-[546px] h-auto min-h-[188px] bg-[#FFD635] rounded-[22px] p-4">
          <div class="text-[#004B75] text-[20px] lg:text-2xl font-bold font-['Poppins'] text-center lg:pl-2">
            Produk yang bisa dibeli
          </div>
          <div id="produkList" class="text-[#004B75] text-base font-bold font-['Poppins'] pt-2 pl-2 grid grid-cols-1 sm:grid-cols-2 gap-y-2 pr-4 leading-snug">
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <!-- Placeholder untuk footer yang akan diisi oleh component.js -->
  <footer id="footer-container"></footer>

  <!-- Memuat komponen menggunakan component.js -->
  <!-- Pastikan path ke file component.js sudah benar sesuai struktur folder Anda -->
  <script src="../js/component.js"></script>

  <!-- LOGIKA HITUNG -->
  <script>
    function truncateText(text, maxLength) {
      if (text.length <= maxLength) return text;
      return text.slice(0, maxLength) + "...";
    }

    function formatRupiah(angka) {
      return `Rp${angka.toLocaleString("id-ID")}`;
    }

    document.getElementById("btnHitung").addEventListener("click", async () => {
      const nominalInput = document.getElementById("nominal");
      const durasiInput = document.getElementById("durasi");
      const totalTabunganEl = document.getElementById("totalTabungan");
      const produkBox = document.getElementById("produkList");

      if (!nominalInput.value || !durasiInput.value) {
        alert("Harap isi nominal tabungan dan durasi menabung.");
        return;
      }

      const nominal = parseInt(nominalInput.value.replace(/\D/g, ""), 10);
      const hari = parseInt(durasiInput.value.replace(/\D/g, ""), 10);

      if (isNaN(nominal) || isNaN(hari) || nominal <= 0 || hari <= 0) {
        alert("Mohon masukkan angka yang valid (lebih besar dari 0).");
        return;
      }

      const total = nominal * hari;
      totalTabunganEl.textContent = formatRupiah(total);
      produkBox.innerHTML = "<div class='col-span-full text-center'>‚è≥ Sedang mencari...</div>";

      try {
        const response = await fetch('http://localhost:3000/produk', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ total }),
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        const data = await response.json();
        produkBox.innerHTML = "";

        if (data && data.length > 0) {
          data.forEach((item, index) => {
            const div = document.createElement("div");
            div.textContent = `${index + 1}. ${truncateText(item.nama, 20)}`;
            produkBox.appendChild(div);
          });
        } else {
          produkBox.innerHTML = "<div class='col-span-full text-center'>‚ùå Tidak ada rekomendasi untuk budget ini.</div>";
        }
      } catch (error) {
        console.error("Tidak dapat mengambil data:", error);
        produkBox.innerHTML = "<div class='col-span-full text-center'>üîå Gagal terhubung ke server.</div>";
      }
    });
  </script>
</body>
</html>
