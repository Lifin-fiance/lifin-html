<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard LIFIN</title>
    <meta name="description" content="Akses Panel Admin LIFIN untuk manajemen pengguna, konten, dan data aplikasi.">
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/png" href="assets/images/fav.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Baloo 2', cursive;
        }
        .sidebar-link.active, .mobile-nav-link.active {
            color: #04B3E3;
        }
        .sidebar-link.active {
            background-color: white;
            border-radius: 12px;
        }
        .sidebar-link.active img, .mobile-nav-link.active img {
            filter: invert(55%) sepia(86%) saturate(2267%) hue-rotate(159deg) brightness(96%) contrast(96%);
        }
        .action-btn {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .action-btn:hover {
            transform: scale(1.1);
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        main {
            padding-left: 0;
            padding-right: 0;
        }
        header {
            padding-left: 2rem;
            padding-right: 2rem;
        }
        @media (max-width: 768px) {
            header {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
    </style>
</head>

<body class="bg-white">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-[200px] bg-[#04B3E3] text-white flex-col justify-between p-4 hidden md:flex">
            <div>
                <div class="bg-white rounded-[25px] py-[7px] px-[10px] mb-10 mt-[24px] flex items-center justify-center">
                    <img src="https://placehold.co/75x40/04B3E3/FFFFFF?text=LIFIN" alt="LIFIN Logo" class="w-[75px]">
                </div>
                <nav class="flex flex-col space-y-4">
                    <a href="#" id="tab-pengguna" class="sidebar-link active flex items-center space-x-4 p-3 rounded-lg transition-all">
                        <img src="assets/images/user-blue.svg" alt="Pengguna Icon" class="w-[30px]" data-inactive="assets/images/user-white.svg" data-active="assets/images/user-blue.svg">
                        <span class="font-bold">Pengguna</span>
                    </a>
                    <a href="#" id="tab-berita" class="sidebar-link flex items-center space-x-4 p-3 rounded-lg transition-all">
                        <img src="assets/images/news-white.svg" alt="Berita Icon" class="w-[30px]" data-inactive="assets/images/news-white.svg" data-active="assets/images/news-blue.svg">
                        <span class="font-bold">Berita</span>
                    </a>
                    <a href="#" id="tab-flipcard" class="sidebar-link flex items-center space-x-4 p-3 rounded-lg transition-all">
                        <img src="assets/images/add-white.svg" alt="Flip Card Icon" class="w-[30px]" data-inactive="assets/images/add-white.svg" data-active="assets/images/add-blue.svg">
                        <span class="font-bold">Flip Card</span>
                    </a>
                </nav>
            </div>
            <div>
                <button id="logout-button" class="flex items-center space-x-4 p-3 w-full text-left hover:bg-white/20 rounded-lg transition-all">
                    <img src="https://placehold.co/24x24/FFFFFF/000000?text=L" alt="Logout Icon" class="w-6 h-6">
                    <span class="font-bold">Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 pt-4 md:pt-8 overflow-y-auto no-scrollbar pb-24 md:pb-8">
            <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <h1 id="page-title" class="text-3xl font-extrabold text-gray-800">Pengguna</h1>
                <div class="relative w-full md:w-1/3">
                    <input type="text" id="search-input" placeholder="Cari..." class="w-full pl-4 pr-10 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#04B3E3] font-semibold">
                    <svg class="w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </header>

            <!-- Content Panels -->
            <div>
                <!-- Pengguna Panel -->
                <div id="panel-pengguna">
                    <div class="bg-white overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="border-b-2 border-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">Nama</th>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">Jenjang</th>
                                    <th class="px-6 py-3 text-center text-sm font-bold text-gray-600 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengguna-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Berita Panel -->
                <div id="panel-berita" class="hidden">
                    <div class="px-4 md:px-8 mb-4">
                        <button id="add-berita-btn" class="px-6 py-2 bg-[#FFC700] text-gray-800 font-bold rounded-lg hover:bg-yellow-400 transition-all flex items-center space-x-2">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                            <span>Tambah Berita</span>
                        </button>
                    </div>
                    <div class="bg-white overflow-x-auto">
                        <table class="min-w-full">
                             <thead class="border-b-2 border-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">Judul</th>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">Penulis</th>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-center text-sm font-bold text-gray-600 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="berita-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Flip Card Panel -->
                <div id="panel-flipcard" class="hidden">
                    <div class="px-4 md:px-8 mb-4">
                        <button id="add-flipcard-btn" class="px-6 py-2 bg-[#FFC700] text-gray-800 font-bold rounded-lg hover:bg-yellow-400 transition-all flex items-center space-x-2">
                             <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                            <span>Tambah Kartu</span>
                        </button>
                    </div>
                    <div class="bg-white overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="border-b-2 border-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">No</th>
                                    <th class="px-6 py-3 text-left text-sm font-bold text-gray-600 uppercase tracking-wider">Head</th>
                                    <th class="px-6 py-3 text-center text-sm font-bold text-gray-600 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="flipcard-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Bottom Navbar -->
    <nav class="md:hidden fixed bottom-0 inset-x-0 bg-white shadow-t-lg flex justify-around p-2 z-50">
        <a href="#" id="mobile-tab-pengguna" class="mobile-nav-link active flex flex-col items-center justify-center text-gray-500">
            <img src="assets/images/user-blue.svg" alt="Pengguna Icon" class="w-6 h-6" data-inactive="assets/images/user-white.svg" data-active="assets/images/user-blue.svg">
            <span class="text-xs font-semibold">Pengguna</span>
        </a>
        <a href="#" id="mobile-tab-berita" class="mobile-nav-link flex flex-col items-center justify-center text-gray-500">
            <img src="assets/images/news-white.svg" alt="Berita Icon" class="w-6 h-6" data-inactive="assets/images/news-white.svg" data-active="assets/images/news-blue.svg">
            <span class="text-xs font-semibold">Berita</span>
        </a>
        <a href="#" id="mobile-tab-flipcard" class="mobile-nav-link flex flex-col items-center justify-center text-gray-500">
            <img src="assets/images/add-white.svg" alt="Flip Card Icon" class="w-6 h-6" data-inactive="assets/images/add-white.svg" data-active="assets/images/add-blue.svg">
            <span class="text-xs font-semibold">Flip Card</span>
        </a>
         <button id="mobile-logout-button" class="flex flex-col items-center justify-center text-gray-500">
            <img src="https://placehold.co/24x24/000000/FFFFFF?text=L" alt="Logout Icon" class="w-6 h-6">
            <span class="text-xs font-semibold">Logout</span>
        </button>
    </nav>

    <!-- Modals -->
    <!-- All modals are defined here -->
    <!-- (Modal HTML is unchanged from your previous version) -->
    <div id="edit-pengguna-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">...</div>
    <div id="berita-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden p-4 z-50">...</div>
    <div id="flipcard-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">...</div>
    
    <!-- Firebase and App Logic -->
    <script type="module">
        // Import fungsi-fungsi yang diperlukan dari Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, getDoc, addDoc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyD6PXpGANlwOd2kKIN07IO8v2hSrW7F-O4",
            authDomain: "lifin-6f82c.firebaseapp.com",
            projectId: "lifin-6f82c",
            storageBucket: "lifin-6f82c.firebasestorage.app",
            messagingSenderId: "598554906926",
            appId: "1:598554906926:web:27ae9353f5a375f27f2abf"
        };

        // Inisialisasi Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Cek status otentikasi pengguna
        onAuthStateChanged(auth, user => {
            if (user) {
                // Pengguna sudah login, jalankan fungsi utama
                main();
            } else {
                // Pengguna belum login, arahkan ke halaman login
                window.location.href = 'login.html';
            }
        });
        
        // Fungsi utama aplikasi
        function main() {
            // === UI MANAGEMENT ===
            const pageTitle = document.getElementById('page-title');
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
            const allLinks = [...sidebarLinks, ...mobileNavLinks];
            const panels = {
                'pengguna': document.getElementById('panel-pengguna'),
                'berita': document.getElementById('panel-berita'),
                'flipcard': document.getElementById('panel-flipcard')
            };

            function switchTab(tabName) {
                Object.values(panels).forEach(panel => panel.classList.add('hidden'));
                if (panels[tabName]) {
                    panels[tabName].classList.remove('hidden');
                }
                pageTitle.textContent = tabName.charAt(0).toUpperCase() + tabName.slice(1);

                allLinks.forEach(link => {
                    const linkName = link.id.includes('mobile') ? link.id.split('-')[2] : link.id.split('-')[1];
                    const icon = link.querySelector('img');
                    const inactiveSrc = icon.getAttribute('data-inactive');
                    const activeSrc = icon.getAttribute('data-active');

                    if (linkName === tabName) {
                        link.classList.add('active');
                        if (activeSrc) icon.src = activeSrc;
                    } else {
                        link.classList.remove('active');
                        if (inactiveSrc) icon.src = inactiveSrc;
                    }
                });
            }

            allLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabName = e.currentTarget.id.includes('mobile') ? e.currentTarget.id.split('-')[2] : e.currentTarget.id.split('-')[1];
                    switchTab(tabName);
                });
            });

            switchTab('pengguna'); // Inisialisasi tab
            
            // === LOGOUT LOGIC ===
            const logoutButtons = [document.getElementById('logout-button'), document.getElementById('mobile-logout-button')];
            logoutButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    signOut(auth).catch(error => console.error("Logout error:", error));
                });
            });

            // === DATA RENDERING ===
            const penggunaTableBody = document.getElementById('pengguna-table-body');
            const beritaTableBody = document.getElementById('berita-table-body');
            const flipcardTableBody = document.getElementById('flipcard-table-body');

            // Render data pengguna
            onSnapshot(collection(db, "users"), (snapshot) => {
                let rows = '';
                snapshot.forEach(doc => {
                    const user = doc.data();
                    rows += `
                        <tr class="border-b">
                            <td class="px-6 py-4 whitespace-nowrap font-semibold">${user.nama || ''}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${user.email || ''}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${user.jenjang || 'UMUM'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <div class="flex items-center justify-center space-x-4">
                                    <img src="assets/images/edit-admin.svg" alt="Edit" class="w-6 h-6 action-btn edit-pengguna-btn" data-id="${doc.id}">
                                    <img src="assets/images/trash-admin.svg" alt="Delete" class="w-6 h-6 action-btn delete-pengguna-btn" data-id="${doc.id}">
                                </div>
                            </td>
                        </tr>
                    `;
                });
                penggunaTableBody.innerHTML = rows;
            });
            
            // Render data berita
            onSnapshot(collection(db, "berita"), (snapshot) => {
                let rows = '';
                snapshot.forEach(doc => {
                    const berita = doc.data();
                    const tgl = berita.tanggal?.toDate().toLocaleDateString('id-ID') || 'N/A';
                    rows += `
                        <tr class="border-b">
                            <td class="px-6 py-4 whitespace-nowrap font-semibold">${berita.judul}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${berita.penulis}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${tgl}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <div class="flex items-center justify-center space-x-4">
                                    <img src="assets/images/edit-admin.svg" alt="Edit" class="w-6 h-6 action-btn edit-berita-btn" data-id="${doc.id}">
                                    <img src="assets/images/trash-admin.svg" alt="Delete" class="w-6 h-6 action-btn delete-berita-btn" data-id="${doc.id}">
                                </div>
                            </td>
                        </tr>
                    `;
                });
                beritaTableBody.innerHTML = rows;
            });

            // Render data flipcard
            onSnapshot(collection(db, "flipcards"), (snapshot) => {
                let rows = '';
                snapshot.forEach(doc => {
                    const card = doc.data();
                    rows += `
                        <tr class="border-b">
                            <td class="px-6 py-4 whitespace-nowrap font-semibold">${card.no}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${card.head}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <div class="flex items-center justify-center space-x-4">
                                    <img src="assets/images/edit-admin.svg" alt="Edit" class="w-6 h-6 action-btn edit-flipcard-btn" data-id="${doc.id}">
                                    <img src="assets/images/trash-admin.svg" alt="Delete" class="w-6 h-6 action-btn delete-flipcard-btn" data-id="${doc.id}">
                                </div>
                            </td>
                        </tr>
                    `;
                });
                flipcardTableBody.innerHTML = rows;
            });
            
            // === CRUD & MODAL LOGIC ===
            // (Tambahkan logika untuk buka/tutup modal, simpan, dan hapus data di sini)
            // Contoh:
            document.body.addEventListener('click', async (e) => {
                // Hapus Pengguna
                if (e.target.classList.contains('delete-pengguna-btn')) {
                    const id = e.target.dataset.id;
                    if (confirm('Apakah Anda yakin ingin menghapus pengguna ini?')) {
                        await deleteDoc(doc(db, "users", id));
                        alert('Pengguna berhasil dihapus.');
                    }
                }
                // Hapus Berita
                if (e.target.classList.contains('delete-berita-btn')) {
                    const id = e.target.dataset.id;
                    if (confirm('Apakah Anda yakin ingin menghapus berita ini?')) {
                        await deleteDoc(doc(db, "berita", id));
                        alert('Berita berhasil dihapus.');
                    }
                }
                // Hapus Flip Card
                if (e.target.classList.contains('delete-flipcard-btn')) {
                    const id = e.target.dataset.id;
                    if (confirm('Apakah Anda yakin ingin menghapus kartu ini?')) {
                        await deleteDoc(doc(db, "flipcards", id));
                        alert('Kartu berhasil dihapus.');
                    }
                }
            });
        }
    </script>
</body>
</html>
